# BBS数据可视化与分析系统

本项目是一个用于处理、分析和可视化BBS论坛数据的系统，包含数据预处理、多维度统计分析和可视化展示功能。系统通过对论坛帖子数据的收集和分析，提供了丰富的数据可视化和统计分析功能，帮助用户了解论坛活动趋势、用户行为和内容热点。

## 项目亮点

- **实时数据可视化**：通过直观的图表展示论坛活动数据，包括发帖量、更新量、阅读量等指标
- **多维度数据分析**：支持按小时、日、周、月等多个时间维度进行数据分析
- **用户行为洞察**：分析用户发帖、回复、重发等行为，识别活跃用户和热门内容
- **内容热点发现**：通过词云展示热门话题和关键词，快速把握论坛热点
- **高性能数据处理**：采用缓存机制和定时任务，提高数据处理和展示效率
- **完整的前后端分离架构**：前端使用React，后端使用Flask，实现了清晰的职责分离

## 项目结构

```
bbs_data/
├── backend/           # 后端Flask API
│   ├── app.py         # 主应用程序
│   ├── config.py      # 配置文件
│   ├── check_data.py  # 数据检查脚本
│   ├── db/            # 数据库文件
│   ├── data/          # 数据目录
│   ├── services/      # 服务模块
│   └── models/        # 数据模型
├── frontend/          # 前端React应用
│   ├── src/           # 源代码
│   ├── public/        # 静态资源
│   └── package.json   # 依赖配置
├── data/              # 数据文件
│   ├── raw/           # 原始数据
│   └── processed/     # 处理后的数据
├── py/                # Python数据处理脚本
│   ├── reset_db.py    # 重置数据库脚本
│   ├── check_db.py    # 检查数据库脚本
│   ├── list.py        # 列表数据处理脚本
│   ├── post.py        # 帖子数据处理脚本
│   └── analysis.py    # 数据分析脚本
└── requirements.txt   # 项目依赖
```

## 功能特性

### 数据可视化大盘

#### 1. 发帖量统计
- **展示形式**: 折线图，直观展示发帖量趋势
- **时间维度**: 支持小时、日、周、月四种时间粒度切换
- **小时维度**: 展示最近90小时数据，精细把握短期趋势
- **日/周/月维度**: 最多展示30/20/20个最新数据点，兼顾长期趋势分析
- **交互功能**: 支持图表缩放、数据点悬停查看详情

#### 2. 更新量统计
- **展示形式**: 3条折线图(分别对应重发、回帖、删回帖)，区分不同类型的更新行为
- **时间维度**: 支持小时、日、周、月四种时间粒度切换
- **小时维度**: 展示最近90小时数据，精细把握短期趋势
- **日/周/月维度**: 最多展示30/20/20个最新数据点，兼顾长期趋势分析
- **图例交互**: 支持点击图例显示/隐藏特定类型的数据线

#### 3. 阅读量统计
- **展示形式**: 折线图(增量数据)，直观展示阅读量增长趋势
- **时间维度**: 支持小时、日、周、月四种时间粒度切换
- **小时维度**: 展示最近90小时数据，精细把握短期趋势
- **日/周/月维度**: 最多展示30/20/20个最新数据点，兼顾长期趋势分析
- **数据对比**: 支持不同时间段数据对比分析

#### 4. 帖子排行榜
- **排序规则**: 按重发次数(repost_count)倒序，突出显示最活跃的帖子
- **分页功能**: 每页10条，后端分页实现，支持快速浏览大量数据
- **详细信息**: 展示帖子标题、作者、发布时间、重发次数、回复次数等信息
- **链接功能**: 支持点击标题直接跳转到原帖

#### 5. 用户排行榜
- **排序规则**: 按重发次数(repost_count)倒序，突出显示最活跃的用户
- **分页功能**: 每页10条，后端分页实现，支持快速浏览大量数据
- **详细信息**: 展示用户名、重发次数、回复次数、删回帖次数等信息
- **链接功能**: 支持点击用户名跳转到用户主页

#### 6. 热门词汇
- **展示形式**: 词云，直观展示热门关键词及其权重
- **数据来源**: 帖子标题，反映论坛热点话题
- **词汇分层**: 大词20个，中词55个，小词225个，层次分明
- **性能优化**: 实现了数据库缓存和定时更新机制，提高加载速度
- **自动更新**: 每天凌晨2点自动更新词云数据，保持内容时效性
- **缓存管理**: 词云数据缓存7天，减少服务器计算负担
- **手动刷新**: 支持通过API手动刷新词云数据

### 数据分析功能

#### 分析一：发帖时间分布分析
- **日发帖量统计表**: 按日期和小时段统计发帖数量，包含总计列
- **周发帖量统计表**: 按自然周和小时段汇总发帖数量，包含总计列
- **月发帖量统计表**: 按自然月和小时段汇总发帖数量，包含总计列
- **时段发帖汇总表**: 按小时段视角汇总所有日期的发帖数量，包含总计行

#### 分析二：帖子更新行为分析
- **日更新量统计表**: 按日期、小时段和更新原因（重发、回帖、删回帖）统计更新数量，包含总计列
- **周更新量统计表**: 按自然周、小时段和更新原因汇总更新数量，包含总计列
- **月更新量统计表**: 按自然月、小时段和更新原因汇总更新数量，包含总计列
- **时段更新汇总表**: 按小时段视角汇总所有更新原因数据，包含总计行
- **更新类型分析**: 分析不同更新类型的分布和趋势

#### 分析三：阅读量增长分析
- **日阅读量增量表**: 按日期和小时段统计阅读量增长，包含总计列
- **月阅读量平均增量表**: 按月份和小时段计算平均阅读量增长，包含总计列（平均值）
- **增长趋势图**: 展示阅读量增长趋势，识别高峰和低谷时段

#### 分析四：帖子活跃度排行榜
- **综合排名**: 按重发次数降序排列的帖子活跃度排行
- **详细信息**: 包含URL、发帖时间、最近更新时间、标题、发帖天数、作者和各类更新行为次数
- **筛选功能**: 支持按时间范围、作者、更新类型等条件筛选

#### 分析五：用户活跃度排行榜
- **综合排名**: 按重发次数降序排列的用户活跃度排行
- **详细信息**: 包含作者和各类更新行为次数
- **活跃度指标**: 展示用户的重发、回帖、删回帖等活动数据

## 技术栈

### 前端
- **React 18**: 用于构建用户界面的JavaScript库
- **Ant Design**: 企业级UI设计语言和React组件库
- **Ant Design Charts**: 基于G2Plot的图表库，提供丰富的可视化组件
- **Axios**: 基于Promise的HTTP客户端，用于浏览器和Node.js
- **React Router**: 为React应用提供声明式路由
- **Redux**: 可预测的状态容器，管理应用状态

### 后端
- **Flask**: 轻量级Web应用框架
- **Pandas**: 强大的数据分析和处理库
- **SQLite**: 轻量级关系型数据库
- **Jieba**: 中文分词库，用于词云生成
- **Flask-CORS**: 处理跨域资源共享
- **Schedule**: 任务调度库，用于定时任务

## 安装与运行

### 环境要求
- Python 3.8+
- Node.js 14+
- npm 6+

### 后端

1. 克隆仓库:
```bash
git clone https://github.com/rbtsama/bbs_dashboard.git
cd bbs_dashboard
```

2. 安装依赖:
```bash
pip install -r requirements.txt
```

3. 启动后端服务:
```bash
cd backend
python app.py
```

后端服务将在 http://localhost:5000 运行。

### 前端

1. 安装依赖:
```bash
cd frontend
npm install
```

2. 启动开发服务器:
```bash
npm start
```

前端应用将在 http://localhost:3000 运行。

## 数据处理

### 环境要求与安装
```bash
pip install pandas openpyxl tqdm colorama
```

### 输入数据格式要求

#### 发帖列表数据 (bbs_post_list_YYYYMMDD.xlsx)
必须包含以下字段：
- **url**: 帖子URL，作为唯一标识
- **title**: 帖子标题
- **author**: 作者名称
- **post_time_str**: 发帖时间字符串，格式为"YYYY-MM-DD HH:MM:SS"
- **scraping_time_str**: 爬取时间字符串，格式为"YYYY-MM-DD HH:MM:SS"

#### 更新列表数据 (bbs_update_list_YYYYMMDD.xlsx)
必须包含以下字段：
- **url**: 帖子URL，作为唯一标识
- **title**: 帖子标题
- **author**: 作者名称
- **list_time_str**: 列表时间字符串，格式为"YYYY-MM-DD HH:MM:SS"
- **scraping_time_str**: 爬取时间字符串，格式为"YYYY-MM-DD HH:MM:SS"
- **read_count**: 阅读数量
- **reply_count**: 回复数量
- **last_reply_time_str**: 最后回复时间字符串，格式为"YYYY-MM-DD HH:MM:SS"

### 数据处理流程

```bash
cd py
```

1. **准备原始数据**:
   - 确保 `data/raw` 目录中存在正确的文件名和相关文件
   - 文件命名格式应为 `bbs_post_list_YYYYMMDD.xlsx` 和 `bbs_update_list_YYYYMMDD.xlsx`

2. **数据预处理**:
   ```bash
   python post.py    # 处理帖子数据
   python list.py    # 处理列表数据
   ```

3. **数据分析**:
   ```bash
   python analysis.py    # 运行数据分析脚本
   ```

4. **数据库导入**:
   ```bash
   python reset_db.py    # 将处理后的数据导入数据库
   ```

5. **验证导入结果** (可选):
   ```bash
   python check_db.py    # 检查数据库状态
   ```

## 系统功能使用指南

### 数据可视化大盘
1. 启动前端和后端服务
2. 访问 http://localhost:3000 打开数据可视化大盘
3. 在顶部导航栏选择不同的功能模块
4. 使用时间粒度选择器切换不同的时间维度
5. 使用图表交互功能（缩放、悬停、点击）探索数据

### 数据分析报告
1. 运行 `py/analysis.py` 生成数据分析报告
2. 分析结果将保存在 `data/analysis` 目录下
3. 在前端界面的"分析报告"模块查看可视化的分析结果

## 系统维护

### 定时任务
系统内置了定时任务功能，每天凌晨2:00自动更新词云数据。

### 缓存管理
词云数据使用数据库缓存，缓存有效期为7天。可以通过API手动刷新缓存：
```
POST /api/refresh-wordcloud
```

### 数据备份
建议定期备份 `backend/db/forum_data.db` 数据库文件，以防数据丢失。

## 贡献指南

欢迎贡献代码、报告问题或提出改进建议。请遵循以下步骤：

1. Fork 仓库
2. 创建特性分支 (`git checkout -b feature/amazing-feature`)
3. 提交更改 (`git commit -m 'Add some amazing feature'`)
4. 推送到分支 (`git push origin feature/amazing-feature`)
5. 创建 Pull Request

## 许可证

本项目采用 MIT 许可证 - 详情请参阅 [LICENSE](LICENSE) 文件。

## 联系方式

如有任何问题或建议，请通过以下方式联系我们：

- 项目仓库: [GitHub](https://github.com/rbtsama/bbs_dashboard)
