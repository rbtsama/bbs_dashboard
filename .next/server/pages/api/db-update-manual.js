"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/db-update-manual";
exports.ids = ["pages/api/db-update-manual"];
exports.modules = {

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("child_process");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fdb-update-manual&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cdb-update-manual.js&middlewareConfigBase64=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fdb-update-manual&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cdb-update-manual.js&middlewareConfigBase64=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_db_update_manual_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\db-update-manual.js */ \"(api)/./pages/api/db-update-manual.js\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_db_update_manual_js__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_db_update_manual_js__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/db-update-manual\",\n        pathname: \"/api/db-update-manual\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_db_update_manual_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmRiLXVwZGF0ZS1tYW51YWwmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZwYWdlcyU1Q2FwaSU1Q2RiLXVwZGF0ZS1tYW51YWwuanMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ0w7QUFDMUQ7QUFDOEQ7QUFDOUQ7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLDJEQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQywyREFBUTtBQUNwQztBQUNPLHdCQUF3QixnSEFBbUI7QUFDbEQ7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iYnMtZGF0YS1tYW5hZ2VyLz8zOTcwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBhZ2VzQVBJUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgaG9pc3QgfSBmcm9tIFwibmV4dC9kaXN0L2J1aWxkL3RlbXBsYXRlcy9oZWxwZXJzXCI7XG4vLyBJbXBvcnQgdGhlIHVzZXJsYW5kIGNvZGUuXG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiLi9wYWdlc1xcXFxhcGlcXFxcZGItdXBkYXRlLW1hbnVhbC5qc1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCBcImRlZmF1bHRcIik7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCBcImNvbmZpZ1wiKTtcbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSByb3V0ZSBtb2R1bGUgdGhhdCB3aWxsIGJlIGNvbnN1bWVkLlxuZXhwb3J0IGNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2RiLXVwZGF0ZS1tYW51YWxcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9kYi11cGRhdGUtbWFudWFsXCIsXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgYXJlbid0IHVzZWQgaW4gcHJvZHVjdGlvbi5cbiAgICAgICAgYnVuZGxlUGF0aDogXCJcIixcbiAgICAgICAgZmlsZW5hbWU6IFwiXCJcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fdb-update-manual&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cdb-update-manual.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./pages/api/db-update-manual.js":
/*!***************************************!*\
  !*** ./pages/api/db-update-manual.js ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var child_process__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! child_process */ \"child_process\");\n/* harmony import */ var child_process__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(child_process__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_2__);\n/**\n * @fileoverview 手动数据库更新API端点\n * \n * 此API用于手动触发数据库更新流程，使用web界面而不是CRON触发\n * 主要用于管理员手动更新数据库\n */ \n\n\n// 验证密钥\nconst ADMIN_KEY = \"admin123\" || 0;\n// 更新锁文件路径\nconst LOCK_FILE = path__WEBPACK_IMPORTED_MODULE_1___default().join(process.cwd(), \"tmp\", \"db_update.lock\");\n// 最新状态文件路径\nconst STATUS_FILE = path__WEBPACK_IMPORTED_MODULE_1___default().join(process.cwd(), \"tmp\", \"db_update_status.json\");\n// 存储当前运行的进程\nlet currentProcess = null;\n/**\n * 检查更新是否正在进行中\n */ function isUpdateRunning() {\n    try {\n        return fs__WEBPACK_IMPORTED_MODULE_2___default().existsSync(LOCK_FILE);\n    } catch (error) {\n        console.error(\"检查锁文件失败:\", error);\n        return false;\n    }\n}\n/**\n * 创建更新锁\n */ function createLock() {\n    try {\n        fs__WEBPACK_IMPORTED_MODULE_2___default().writeFileSync(LOCK_FILE, new Date().toISOString());\n    } catch (error) {\n        console.error(\"创建锁文件失败:\", error);\n    }\n}\n/**\n * 释放更新锁\n */ function releaseLock() {\n    try {\n        if (fs__WEBPACK_IMPORTED_MODULE_2___default().existsSync(LOCK_FILE)) {\n            fs__WEBPACK_IMPORTED_MODULE_2___default().unlinkSync(LOCK_FILE);\n        }\n    } catch (error) {\n        console.error(\"释放锁文件失败:\", error);\n    }\n}\n/**\n * 保存更新状态\n */ function saveStatus(status) {\n    try {\n        fs__WEBPACK_IMPORTED_MODULE_2___default().writeFileSync(STATUS_FILE, JSON.stringify(status, null, 2));\n    } catch (error) {\n        console.error(\"保存状态文件失败:\", error);\n    }\n}\n/**\n * 获取最新更新状态\n */ function getStatus() {\n    try {\n        if (fs__WEBPACK_IMPORTED_MODULE_2___default().existsSync(STATUS_FILE)) {\n            return JSON.parse(fs__WEBPACK_IMPORTED_MODULE_2___default().readFileSync(STATUS_FILE, \"utf8\"));\n        }\n        return {\n            status: \"never_run\",\n            last_run: null,\n            message: \"从未执行过更新\"\n        };\n    } catch (error) {\n        console.error(\"读取状态文件失败:\", error);\n        return {\n            status: \"error\",\n            message: \"读取状态文件失败\"\n        };\n    }\n}\n/**\n * 执行命令\n */ function executeCommand(cmd, args, extraArgs = []) {\n    return new Promise((resolve, reject)=>{\n        // 处理路径和参数\n        let scriptPath;\n        let allArgs = [];\n        if (args && args.length > 0) {\n            scriptPath = path__WEBPACK_IMPORTED_MODULE_1___default().join(process.cwd(), ...args);\n            allArgs.push(scriptPath);\n        }\n        // 添加额外参数\n        if (extraArgs && extraArgs.length > 0) {\n            allArgs = allArgs.concat(extraArgs);\n        }\n        console.log(`执行命令: ${cmd} ${allArgs.join(\" \")}`);\n        const process1 = (0,child_process__WEBPACK_IMPORTED_MODULE_0__.spawn)(cmd, allArgs, {\n            cwd: process.cwd(),\n            env: {\n                ...process.env,\n                PYTHONIOENCODING: \"utf-8\",\n                PYTHONUNBUFFERED: \"1\",\n                PYTHONUTF8: \"1\"\n            }\n        });\n        // 存储当前进程\n        currentProcess = process1;\n        let output = \"\";\n        let errorOutput = \"\";\n        process1.stdout.on(\"data\", (data)=>{\n            const text = data.toString(\"utf-8\");\n            output += text;\n            console.log(`输出: ${text}`);\n        });\n        process1.stderr.on(\"data\", (data)=>{\n            const text = data.toString(\"utf-8\");\n            errorOutput += text;\n            console.error(`错误: ${text}`);\n        });\n        process1.on(\"close\", (code)=>{\n            if (currentProcess === process1) {\n                currentProcess = null;\n            }\n            if (code === 0) {\n                resolve(output);\n            } else {\n                reject(new Error(`命令执行失败 (${code}): ${errorOutput || output}`));\n            }\n        });\n        process1.on(\"error\", (err)=>{\n            if (currentProcess === process1) {\n                currentProcess = null;\n            }\n            reject(new Error(`启动命令失败: ${err.message}`));\n        });\n    });\n}\n/**\n * 执行更新步骤\n */ async function executeStep(stepName, commands) {\n    console.log(`开始执行步骤: ${stepName}`);\n    for (const command of commands){\n        try {\n            await executeCommand(command.cmd, command.args, command.extraArgs);\n        } catch (error) {\n            console.error(`步骤 ${stepName} 执行失败:`, error);\n            throw error;\n        }\n    }\n}\n/**\n * 停止更新进程\n */ function stopUpdate() {\n    try {\n        // 终止当前运行的进程\n        if (currentProcess) {\n            try {\n                process.kill(-currentProcess.pid);\n            } catch (e) {\n                try {\n                    currentProcess.kill();\n                } catch (e2) {\n                    console.error(\"终止进程失败:\", e2);\n                }\n            }\n            currentProcess = null;\n        }\n        // 更新状态\n        const status = getStatus();\n        if (status) {\n            status.status = \"stopped\";\n            status.end_time = new Date().toISOString();\n            status.message = \"更新已手动停止\";\n            Object.keys(status.steps).forEach((step)=>{\n                if (status.steps[step].status === \"执行中\" || status.steps[step].status === \"等待中\") {\n                    status.steps[step].status = \"已停止\";\n                    status.steps[step].end_time = new Date().toISOString();\n                }\n            });\n            saveStatus(status);\n        }\n        releaseLock();\n        return true;\n    } catch (error) {\n        console.error(\"停止更新失败:\", error);\n        return false;\n    }\n}\n/**\n * 执行数据库更新\n */ async function runDatabaseUpdate(res) {\n    if (isUpdateRunning()) {\n        return res.status(409).json({\n            success: false,\n            message: \"更新已在进行中\",\n            status: getStatus()\n        });\n    }\n    createLock();\n    const startTime = new Date();\n    const status = {\n        status: \"running\",\n        start_time: startTime.toISOString(),\n        message: \"更新进行中\",\n        steps: {\n            \"数据预处理\": {\n                status: \"等待中\"\n            },\n            \"数据分析\": {\n                status: \"等待中\"\n            },\n            \"数据导入\": {\n                status: \"等待中\"\n            },\n            \"词云生成\": {\n                status: \"等待中\"\n            },\n            \"数据备份\": {\n                status: \"等待中\"\n            }\n        }\n    };\n    saveStatus(status);\n    res.status(202).json({\n        success: true,\n        message: \"更新流程已启动\",\n        status: status\n    });\n    try {\n        // 步骤1: 数据预处理\n        status.steps[\"数据预处理\"].status = \"执行中\";\n        status.steps[\"数据预处理\"].start_time = new Date().toISOString();\n        saveStatus(status);\n        try {\n            await executeStep(\"数据预处理\", [\n                {\n                    cmd: \"python\",\n                    args: [\n                        \"py/post.py\"\n                    ]\n                },\n                {\n                    cmd: \"python\",\n                    args: [\n                        \"py/update.py\"\n                    ]\n                },\n                {\n                    cmd: \"python\",\n                    args: [\n                        \"py/detail.py\"\n                    ]\n                },\n                {\n                    cmd: \"python\",\n                    args: [\n                        \"py/action.py\"\n                    ]\n                },\n                {\n                    cmd: \"python\",\n                    args: [\n                        \"py/car_info.py\"\n                    ]\n                }\n            ]);\n            status.steps[\"数据预处理\"].status = \"完成\";\n        } catch (error) {\n            status.steps[\"数据预处理\"].status = \"失败\";\n            status.steps[\"数据预处理\"].error = error.message;\n        // 非关键步骤失败，继续执行\n        }\n        status.steps[\"数据预处理\"].end_time = new Date().toISOString();\n        saveStatus(status);\n        // 步骤2: 数据分析\n        status.steps[\"数据分析\"].status = \"执行中\";\n        status.steps[\"数据分析\"].start_time = new Date().toISOString();\n        saveStatus(status);\n        try {\n            await executeStep(\"数据分析\", [\n                {\n                    cmd: \"python\",\n                    args: [\n                        \"py/analysis.py\"\n                    ]\n                },\n                {\n                    cmd: \"python\",\n                    args: [\n                        \"py/test_data_quality.py\"\n                    ]\n                }\n            ]);\n            status.steps[\"数据分析\"].status = \"完成\";\n        } catch (error) {\n            status.steps[\"数据分析\"].status = \"失败\";\n            status.steps[\"数据分析\"].error = error.message;\n        // 非关键步骤失败，继续执行\n        }\n        status.steps[\"数据分析\"].end_time = new Date().toISOString();\n        saveStatus(status);\n        // 步骤3: 数据导入 (关键步骤)\n        status.steps[\"数据导入\"].status = \"执行中\";\n        status.steps[\"数据导入\"].start_time = new Date().toISOString();\n        saveStatus(status);\n        try {\n            // 数据库备份 (提前备份以便回滚)\n            await executeStep(\"数据库备份\", [\n                {\n                    cmd: \"python\",\n                    args: [\n                        \"py/backup_db.py\"\n                    ],\n                    extraArgs: [\n                        \"--before-update\"\n                    ]\n                }\n            ]);\n            await executeStep(\"数据导入\", [\n                {\n                    cmd: \"python\",\n                    args: [\n                        \"py/update_db.py\"\n                    ]\n                },\n                {\n                    cmd: \"python\",\n                    args: [\n                        \"py/check_db_structure.py\"\n                    ]\n                }\n            ]);\n            status.steps[\"数据导入\"].status = \"完成\";\n        } catch (error) {\n            status.steps[\"数据导入\"].status = \"失败\";\n            status.steps[\"数据导入\"].error = error.message;\n            // 关键步骤失败，尝试回滚\n            try {\n                await executeStep(\"数据回滚\", [\n                    {\n                        cmd: \"python\",\n                        args: [\n                            \"py/rollback_db.py\"\n                        ]\n                    }\n                ]);\n                status.steps[\"数据导入\"].rollback = \"成功\";\n            } catch (rollbackError) {\n                status.steps[\"数据导入\"].rollback = `失败: ${rollbackError.message}`;\n            }\n            // 关键步骤失败，中止后续步骤\n            status.steps[\"数据导入\"].end_time = new Date().toISOString();\n            status.end_time = new Date().toISOString();\n            status.status = \"failed\";\n            status.message = `数据导入失败: ${error.message}`;\n            saveStatus(status);\n            throw error; // 中断流程\n        }\n        status.steps[\"数据导入\"].end_time = new Date().toISOString();\n        saveStatus(status);\n        // 步骤4: 词云生成\n        status.steps[\"词云生成\"].status = \"执行中\";\n        status.steps[\"词云生成\"].start_time = new Date().toISOString();\n        saveStatus(status);\n        try {\n            await executeStep(\"词云生成\", [\n                {\n                    cmd: \"python\",\n                    args: [\n                        \"py/generate_wordcloud.py\"\n                    ]\n                }\n            ]);\n            status.steps[\"词云生成\"].status = \"完成\";\n        } catch (error) {\n            status.steps[\"词云生成\"].status = \"失败\";\n            status.steps[\"词云生成\"].error = error.message;\n        // 非关键步骤失败，继续执行\n        }\n        status.steps[\"词云生成\"].end_time = new Date().toISOString();\n        saveStatus(status);\n        // 步骤5: 数据备份\n        status.steps[\"数据备份\"].status = \"执行中\";\n        status.steps[\"数据备份\"].start_time = new Date().toISOString();\n        saveStatus(status);\n        try {\n            await executeStep(\"数据备份\", [\n                {\n                    cmd: \"python\",\n                    args: [\n                        \"py/backup_db.py\"\n                    ]\n                }\n            ]);\n            status.steps[\"数据备份\"].status = \"完成\";\n        } catch (error) {\n            status.steps[\"数据备份\"].status = \"失败\";\n            status.steps[\"数据备份\"].error = error.message;\n        // 非关键步骤失败，不影响整体状态\n        }\n        status.steps[\"数据备份\"].end_time = new Date().toISOString();\n        saveStatus(status);\n        // 更新最终状态\n        const failedSteps = Object.keys(status.steps).filter((step)=>status.steps[step].status === \"失败\");\n        status.end_time = new Date().toISOString();\n        if (failedSteps.length === 0) {\n            status.status = \"success\";\n            status.message = \"更新成功完成\";\n        } else {\n            status.status = \"partial_success\";\n            status.message = `更新部分成功，${failedSteps.length}个步骤失败: ${failedSteps.join(\", \")}`;\n        }\n        saveStatus(status);\n    } catch (error) {\n        // 更新失败处理\n        status.status = \"failed\";\n        status.end_time = new Date().toISOString();\n        status.message = `更新失败: ${error.message}`;\n        saveStatus(status);\n    } finally{\n        releaseLock();\n    }\n}\n/**\n * API处理函数\n */ async function handler(req, res) {\n    try {\n        if (!fs__WEBPACK_IMPORTED_MODULE_2___default().existsSync(path__WEBPACK_IMPORTED_MODULE_1___default().join(process.cwd(), \"tmp\"))) {\n            fs__WEBPACK_IMPORTED_MODULE_2___default().mkdirSync(path__WEBPACK_IMPORTED_MODULE_1___default().join(process.cwd(), \"tmp\"), {\n                recursive: true\n            });\n        }\n        if (!fs__WEBPACK_IMPORTED_MODULE_2___default().existsSync(path__WEBPACK_IMPORTED_MODULE_1___default().join(process.cwd(), \"logs\"))) {\n            fs__WEBPACK_IMPORTED_MODULE_2___default().mkdirSync(path__WEBPACK_IMPORTED_MODULE_1___default().join(process.cwd(), \"logs\"), {\n                recursive: true\n            });\n        }\n    } catch (error) {\n        return res.status(500).json({\n            success: false,\n            message: \"无法创建所需目录\",\n            error: error.message\n        });\n    }\n    switch(req.method){\n        case \"GET\":\n            return res.status(200).json({\n                success: true,\n                is_running: isUpdateRunning(),\n                status: getStatus()\n            });\n        case \"POST\":\n            const providedKey = req.headers[\"x-admin-key\"] || req.body?.adminKey;\n            if (providedKey !== ADMIN_KEY) {\n                return res.status(401).json({\n                    success: false,\n                    message: \"管理员密钥无效\"\n                });\n            }\n            if (req.query.action === \"stop\") {\n                const stopped = stopUpdate();\n                return res.status(200).json({\n                    success: stopped,\n                    message: stopped ? \"更新已停止\" : \"停止更新失败\"\n                });\n            }\n            return await runDatabaseUpdate(res);\n        default:\n            return res.status(405).json({\n                success: false,\n                message: \"方法不允许\"\n            });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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cmNlcyI6WyJ3ZWJwYWNrOi8vYmJzLWRhdGEtbWFuYWdlci8uL3BhZ2VzL2FwaS9kYi11cGRhdGUtbWFudWFsLmpzPzM3ZWUiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IOaJi+WKqOaVsOaNruW6k+abtOaWsEFQSeerr+eCuVxuICogXG4gKiDmraRBUEnnlKjkuo7miYvliqjop6blj5HmlbDmja7lupPmm7TmlrDmtYHnqIvvvIzkvb/nlKh3ZWLnlYzpnaLogIzkuI3mmK9DUk9O6Kem5Y+RXG4gKiDkuLvopoHnlKjkuo7nrqHnkIblkZjmiYvliqjmm7TmlrDmlbDmja7lupNcbiAqL1xuXG5pbXBvcnQgeyBzcGF3biB9IGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgZnMgZnJvbSAnZnMnO1xuXG4vLyDpqozor4Hlr4bpkqVcbmNvbnN0IEFETUlOX0tFWSA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0FETUlOX0tFWSB8fCAnYWRtaW4xMjMnO1xuXG4vLyDmm7TmlrDplIHmlofku7bot6/lvoRcbmNvbnN0IExPQ0tfRklMRSA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAndG1wJywgJ2RiX3VwZGF0ZS5sb2NrJyk7XG4vLyDmnIDmlrDnirbmgIHmlofku7bot6/lvoRcbmNvbnN0IFNUQVRVU19GSUxFID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICd0bXAnLCAnZGJfdXBkYXRlX3N0YXR1cy5qc29uJyk7XG5cbi8vIOWtmOWCqOW9k+WJjei/kOihjOeahOi/m+eoi1xubGV0IGN1cnJlbnRQcm9jZXNzID0gbnVsbDtcblxuLyoqXG4gKiDmo4Dmn6Xmm7TmlrDmmK/lkKbmraPlnKjov5vooYzkuK1cbiAqL1xuZnVuY3Rpb24gaXNVcGRhdGVSdW5uaW5nKCkge1xuICB0cnkge1xuICAgIHJldHVybiBmcy5leGlzdHNTeW5jKExPQ0tfRklMRSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcign5qOA5p+l6ZSB5paH5Lu25aSx6LSlOicsIGVycm9yKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cblxuLyoqXG4gKiDliJvlu7rmm7TmlrDplIFcbiAqL1xuZnVuY3Rpb24gY3JlYXRlTG9jaygpIHtcbiAgdHJ5IHtcbiAgICBmcy53cml0ZUZpbGVTeW5jKExPQ0tfRklMRSwgbmV3IERhdGUoKS50b0lTT1N0cmluZygpKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCfliJvlu7rplIHmlofku7blpLHotKU6JywgZXJyb3IpO1xuICB9XG59XG5cbi8qKlxuICog6YeK5pS+5pu05paw6ZSBXG4gKi9cbmZ1bmN0aW9uIHJlbGVhc2VMb2NrKCkge1xuICB0cnkge1xuICAgIGlmIChmcy5leGlzdHNTeW5jKExPQ0tfRklMRSkpIHtcbiAgICAgIGZzLnVubGlua1N5bmMoTE9DS19GSUxFKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcign6YeK5pS+6ZSB5paH5Lu25aSx6LSlOicsIGVycm9yKTtcbiAgfVxufVxuXG4vKipcbiAqIOS/neWtmOabtOaWsOeKtuaAgVxuICovXG5mdW5jdGlvbiBzYXZlU3RhdHVzKHN0YXR1cykge1xuICB0cnkge1xuICAgIGZzLndyaXRlRmlsZVN5bmMoU1RBVFVTX0ZJTEUsIEpTT04uc3RyaW5naWZ5KHN0YXR1cywgbnVsbCwgMikpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ+S/neWtmOeKtuaAgeaWh+S7tuWksei0pTonLCBlcnJvcik7XG4gIH1cbn1cblxuLyoqXG4gKiDojrflj5bmnIDmlrDmm7TmlrDnirbmgIFcbiAqL1xuZnVuY3Rpb24gZ2V0U3RhdHVzKCkge1xuICB0cnkge1xuICAgIGlmIChmcy5leGlzdHNTeW5jKFNUQVRVU19GSUxFKSkge1xuICAgICAgcmV0dXJuIEpTT04ucGFyc2UoZnMucmVhZEZpbGVTeW5jKFNUQVRVU19GSUxFLCAndXRmOCcpKTtcbiAgICB9XG4gICAgcmV0dXJuIHsgc3RhdHVzOiAnbmV2ZXJfcnVuJywgbGFzdF9ydW46IG51bGwsIG1lc3NhZ2U6ICfku47mnKrmiafooYzov4fmm7TmlrAnIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcign6K+75Y+W54q25oCB5paH5Lu25aSx6LSlOicsIGVycm9yKTtcbiAgICByZXR1cm4geyBzdGF0dXM6ICdlcnJvcicsIG1lc3NhZ2U6ICfor7vlj5bnirbmgIHmlofku7blpLHotKUnIH07XG4gIH1cbn1cblxuLyoqXG4gKiDmiafooYzlkb3ku6RcbiAqL1xuZnVuY3Rpb24gZXhlY3V0ZUNvbW1hbmQoY21kLCBhcmdzLCBleHRyYUFyZ3MgPSBbXSkge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIC8vIOWkhOeQhui3r+W+hOWSjOWPguaVsFxuICAgIGxldCBzY3JpcHRQYXRoO1xuICAgIGxldCBhbGxBcmdzID0gW107XG4gICAgXG4gICAgaWYgKGFyZ3MgJiYgYXJncy5sZW5ndGggPiAwKSB7XG4gICAgICBzY3JpcHRQYXRoID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksIC4uLmFyZ3MpO1xuICAgICAgYWxsQXJncy5wdXNoKHNjcmlwdFBhdGgpO1xuICAgIH1cbiAgICBcbiAgICAvLyDmt7vliqDpop3lpJblj4LmlbBcbiAgICBpZiAoZXh0cmFBcmdzICYmIGV4dHJhQXJncy5sZW5ndGggPiAwKSB7XG4gICAgICBhbGxBcmdzID0gYWxsQXJncy5jb25jYXQoZXh0cmFBcmdzKTtcbiAgICB9XG4gICAgXG4gICAgY29uc29sZS5sb2coYOaJp+ihjOWRveS7pDogJHtjbWR9ICR7YWxsQXJncy5qb2luKCcgJyl9YCk7XG4gICAgXG4gICAgY29uc3QgcHJvY2VzczEgPSBzcGF3bihjbWQsIGFsbEFyZ3MsIHtcbiAgICAgIGN3ZDogcHJvY2Vzcy5jd2QoKSxcbiAgICAgIGVudjogeyBcbiAgICAgICAgLi4ucHJvY2Vzcy5lbnYsIFxuICAgICAgICBQWVRIT05JT0VOQ09ESU5HOiAndXRmLTgnLFxuICAgICAgICBQWVRIT05VTkJVRkZFUkVEOiAnMScsXG4gICAgICAgIFBZVEhPTlVURjg6ICcxJ1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8g5a2Y5YKo5b2T5YmN6L+b56iLXG4gICAgY3VycmVudFByb2Nlc3MgPSBwcm9jZXNzMTtcblxuICAgIGxldCBvdXRwdXQgPSAnJztcbiAgICBsZXQgZXJyb3JPdXRwdXQgPSAnJztcblxuICAgIHByb2Nlc3MxLnN0ZG91dC5vbignZGF0YScsIChkYXRhKSA9PiB7XG4gICAgICBjb25zdCB0ZXh0ID0gZGF0YS50b1N0cmluZygndXRmLTgnKTtcbiAgICAgIG91dHB1dCArPSB0ZXh0O1xuICAgICAgY29uc29sZS5sb2coYOi+k+WHujogJHt0ZXh0fWApO1xuICAgIH0pO1xuXG4gICAgcHJvY2VzczEuc3RkZXJyLm9uKCdkYXRhJywgKGRhdGEpID0+IHtcbiAgICAgIGNvbnN0IHRleHQgPSBkYXRhLnRvU3RyaW5nKCd1dGYtOCcpO1xuICAgICAgZXJyb3JPdXRwdXQgKz0gdGV4dDtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYOmUmeivrzogJHt0ZXh0fWApO1xuICAgIH0pO1xuXG4gICAgcHJvY2VzczEub24oJ2Nsb3NlJywgKGNvZGUpID0+IHtcbiAgICAgIGlmIChjdXJyZW50UHJvY2VzcyA9PT0gcHJvY2VzczEpIHtcbiAgICAgICAgY3VycmVudFByb2Nlc3MgPSBudWxsO1xuICAgICAgfVxuICAgICAgaWYgKGNvZGUgPT09IDApIHtcbiAgICAgICAgcmVzb2x2ZShvdXRwdXQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVqZWN0KG5ldyBFcnJvcihg5ZG95Luk5omn6KGM5aSx6LSlICgke2NvZGV9KTogJHtlcnJvck91dHB1dCB8fCBvdXRwdXR9YCkpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcHJvY2VzczEub24oJ2Vycm9yJywgKGVycikgPT4ge1xuICAgICAgaWYgKGN1cnJlbnRQcm9jZXNzID09PSBwcm9jZXNzMSkge1xuICAgICAgICBjdXJyZW50UHJvY2VzcyA9IG51bGw7XG4gICAgICB9XG4gICAgICByZWplY3QobmV3IEVycm9yKGDlkK/liqjlkb3ku6TlpLHotKU6ICR7ZXJyLm1lc3NhZ2V9YCkpO1xuICAgIH0pO1xuICB9KTtcbn1cblxuLyoqXG4gKiDmiafooYzmm7TmlrDmraXpqqRcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZVN0ZXAoc3RlcE5hbWUsIGNvbW1hbmRzKSB7XG4gIGNvbnNvbGUubG9nKGDlvIDlp4vmiafooYzmraXpqqQ6ICR7c3RlcE5hbWV9YCk7XG4gIGZvciAoY29uc3QgY29tbWFuZCBvZiBjb21tYW5kcykge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBleGVjdXRlQ29tbWFuZChjb21tYW5kLmNtZCwgY29tbWFuZC5hcmdzLCBjb21tYW5kLmV4dHJhQXJncyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYOatpemqpCAke3N0ZXBOYW1lfSDmiafooYzlpLHotKU6YCwgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG59XG5cbi8qKlxuICog5YGc5q2i5pu05paw6L+b56iLXG4gKi9cbmZ1bmN0aW9uIHN0b3BVcGRhdGUoKSB7XG4gIHRyeSB7XG4gICAgLy8g57uI5q2i5b2T5YmN6L+Q6KGM55qE6L+b56iLXG4gICAgaWYgKGN1cnJlbnRQcm9jZXNzKSB7XG4gICAgICB0cnkge1xuICAgICAgICBwcm9jZXNzLmtpbGwoLWN1cnJlbnRQcm9jZXNzLnBpZCk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY3VycmVudFByb2Nlc3Mua2lsbCgpO1xuICAgICAgICB9IGNhdGNoIChlMikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+e7iOatoui/m+eoi+Wksei0pTonLCBlMik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGN1cnJlbnRQcm9jZXNzID0gbnVsbDtcbiAgICB9XG5cbiAgICAvLyDmm7TmlrDnirbmgIFcbiAgICBjb25zdCBzdGF0dXMgPSBnZXRTdGF0dXMoKTtcbiAgICBpZiAoc3RhdHVzKSB7XG4gICAgICBzdGF0dXMuc3RhdHVzID0gJ3N0b3BwZWQnO1xuICAgICAgc3RhdHVzLmVuZF90aW1lID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgICAgc3RhdHVzLm1lc3NhZ2UgPSAn5pu05paw5bey5omL5Yqo5YGc5q2iJztcbiAgICAgIFxuICAgICAgT2JqZWN0LmtleXMoc3RhdHVzLnN0ZXBzKS5mb3JFYWNoKHN0ZXAgPT4ge1xuICAgICAgICBpZiAoc3RhdHVzLnN0ZXBzW3N0ZXBdLnN0YXR1cyA9PT0gJ+aJp+ihjOS4rScgfHwgc3RhdHVzLnN0ZXBzW3N0ZXBdLnN0YXR1cyA9PT0gJ+etieW+heS4rScpIHtcbiAgICAgICAgICBzdGF0dXMuc3RlcHNbc3RlcF0uc3RhdHVzID0gJ+W3suWBnOatoic7XG4gICAgICAgICAgc3RhdHVzLnN0ZXBzW3N0ZXBdLmVuZF90aW1lID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgc2F2ZVN0YXR1cyhzdGF0dXMpO1xuICAgIH1cbiAgICBcbiAgICByZWxlYXNlTG9jaygpO1xuICAgIHJldHVybiB0cnVlO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ+WBnOatouabtOaWsOWksei0pTonLCBlcnJvcik7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG5cbi8qKlxuICog5omn6KGM5pWw5o2u5bqT5pu05pawXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHJ1bkRhdGFiYXNlVXBkYXRlKHJlcykge1xuICBpZiAoaXNVcGRhdGVSdW5uaW5nKCkpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDkpLmpzb24oe1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiAn5pu05paw5bey5Zyo6L+b6KGM5LitJyxcbiAgICAgIHN0YXR1czogZ2V0U3RhdHVzKClcbiAgICB9KTtcbiAgfVxuXG4gIGNyZWF0ZUxvY2soKTtcbiAgXG4gIGNvbnN0IHN0YXJ0VGltZSA9IG5ldyBEYXRlKCk7XG4gIGNvbnN0IHN0YXR1cyA9IHtcbiAgICBzdGF0dXM6ICdydW5uaW5nJyxcbiAgICBzdGFydF90aW1lOiBzdGFydFRpbWUudG9JU09TdHJpbmcoKSxcbiAgICBtZXNzYWdlOiAn5pu05paw6L+b6KGM5LitJyxcbiAgICBzdGVwczoge1xuICAgICAgJ+aVsOaNrumihOWkhOeQhic6IHsgc3RhdHVzOiAn562J5b6F5LitJyB9LFxuICAgICAgJ+aVsOaNruWIhuaekCc6IHsgc3RhdHVzOiAn562J5b6F5LitJyB9LFxuICAgICAgJ+aVsOaNruWvvOWFpSc6IHsgc3RhdHVzOiAn562J5b6F5LitJyB9LFxuICAgICAgJ+ivjeS6keeUn+aIkCc6IHsgc3RhdHVzOiAn562J5b6F5LitJyB9LFxuICAgICAgJ+aVsOaNruWkh+S7vSc6IHsgc3RhdHVzOiAn562J5b6F5LitJyB9XG4gICAgfVxuICB9O1xuICBzYXZlU3RhdHVzKHN0YXR1cyk7XG5cbiAgcmVzLnN0YXR1cygyMDIpLmpzb24oe1xuICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgbWVzc2FnZTogJ+abtOaWsOa1geeoi+W3suWQr+WKqCcsXG4gICAgc3RhdHVzOiBzdGF0dXNcbiAgfSk7XG5cbiAgdHJ5IHtcbiAgICAvLyDmraXpqqQxOiDmlbDmja7pooTlpITnkIZcbiAgICBzdGF0dXMuc3RlcHNbJ+aVsOaNrumihOWkhOeQhiddLnN0YXR1cyA9ICfmiafooYzkuK0nO1xuICAgIHN0YXR1cy5zdGVwc1sn5pWw5o2u6aKE5aSE55CGJ10uc3RhcnRfdGltZSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICBzYXZlU3RhdHVzKHN0YXR1cyk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGV4ZWN1dGVTdGVwKCfmlbDmja7pooTlpITnkIYnLCBbXG4gICAgICAgIHsgY21kOiAncHl0aG9uJywgYXJnczogWydweS9wb3N0LnB5J10gfSxcbiAgICAgICAgeyBjbWQ6ICdweXRob24nLCBhcmdzOiBbJ3B5L3VwZGF0ZS5weSddIH0sXG4gICAgICAgIHsgY21kOiAncHl0aG9uJywgYXJnczogWydweS9kZXRhaWwucHknXSB9LFxuICAgICAgICB7IGNtZDogJ3B5dGhvbicsIGFyZ3M6IFsncHkvYWN0aW9uLnB5J10gfSxcbiAgICAgICAgeyBjbWQ6ICdweXRob24nLCBhcmdzOiBbJ3B5L2Nhcl9pbmZvLnB5J10gfVxuICAgICAgXSk7XG4gICAgICBzdGF0dXMuc3RlcHNbJ+aVsOaNrumihOWkhOeQhiddLnN0YXR1cyA9ICflrozmiJAnO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBzdGF0dXMuc3RlcHNbJ+aVsOaNrumihOWkhOeQhiddLnN0YXR1cyA9ICflpLHotKUnO1xuICAgICAgc3RhdHVzLnN0ZXBzWyfmlbDmja7pooTlpITnkIYnXS5lcnJvciA9IGVycm9yLm1lc3NhZ2U7XG4gICAgICAvLyDpnZ7lhbPplK7mraXpqqTlpLHotKXvvIznu6fnu63miafooYxcbiAgICB9XG4gICAgc3RhdHVzLnN0ZXBzWyfmlbDmja7pooTlpITnkIYnXS5lbmRfdGltZSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICBzYXZlU3RhdHVzKHN0YXR1cyk7XG5cbiAgICAvLyDmraXpqqQyOiDmlbDmja7liIbmnpBcbiAgICBzdGF0dXMuc3RlcHNbJ+aVsOaNruWIhuaekCddLnN0YXR1cyA9ICfmiafooYzkuK0nO1xuICAgIHN0YXR1cy5zdGVwc1sn5pWw5o2u5YiG5p6QJ10uc3RhcnRfdGltZSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICBzYXZlU3RhdHVzKHN0YXR1cyk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGV4ZWN1dGVTdGVwKCfmlbDmja7liIbmnpAnLCBbXG4gICAgICAgIHsgY21kOiAncHl0aG9uJywgYXJnczogWydweS9hbmFseXNpcy5weSddIH0sXG4gICAgICAgIHsgY21kOiAncHl0aG9uJywgYXJnczogWydweS90ZXN0X2RhdGFfcXVhbGl0eS5weSddIH1cbiAgICAgIF0pO1xuICAgICAgc3RhdHVzLnN0ZXBzWyfmlbDmja7liIbmnpAnXS5zdGF0dXMgPSAn5a6M5oiQJztcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgc3RhdHVzLnN0ZXBzWyfmlbDmja7liIbmnpAnXS5zdGF0dXMgPSAn5aSx6LSlJztcbiAgICAgIHN0YXR1cy5zdGVwc1sn5pWw5o2u5YiG5p6QJ10uZXJyb3IgPSBlcnJvci5tZXNzYWdlO1xuICAgICAgLy8g6Z2e5YWz6ZSu5q2l6aqk5aSx6LSl77yM57un57ut5omn6KGMXG4gICAgfVxuICAgIHN0YXR1cy5zdGVwc1sn5pWw5o2u5YiG5p6QJ10uZW5kX3RpbWUgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgc2F2ZVN0YXR1cyhzdGF0dXMpO1xuXG4gICAgLy8g5q2l6aqkMzog5pWw5o2u5a+85YWlICjlhbPplK7mraXpqqQpXG4gICAgc3RhdHVzLnN0ZXBzWyfmlbDmja7lr7zlhaUnXS5zdGF0dXMgPSAn5omn6KGM5LitJztcbiAgICBzdGF0dXMuc3RlcHNbJ+aVsOaNruWvvOWFpSddLnN0YXJ0X3RpbWUgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgc2F2ZVN0YXR1cyhzdGF0dXMpO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICAvLyDmlbDmja7lupPlpIfku70gKOaPkOWJjeWkh+S7veS7peS+v+Wbnua7milcbiAgICAgIGF3YWl0IGV4ZWN1dGVTdGVwKCfmlbDmja7lupPlpIfku70nLCBbXG4gICAgICAgIHsgY21kOiAncHl0aG9uJywgYXJnczogWydweS9iYWNrdXBfZGIucHknXSwgZXh0cmFBcmdzOiBbJy0tYmVmb3JlLXVwZGF0ZSddIH1cbiAgICAgIF0pO1xuICAgICAgXG4gICAgICBhd2FpdCBleGVjdXRlU3RlcCgn5pWw5o2u5a+85YWlJywgW1xuICAgICAgICB7IGNtZDogJ3B5dGhvbicsIGFyZ3M6IFsncHkvdXBkYXRlX2RiLnB5J10gfSxcbiAgICAgICAgeyBjbWQ6ICdweXRob24nLCBhcmdzOiBbJ3B5L2NoZWNrX2RiX3N0cnVjdHVyZS5weSddIH1cbiAgICAgIF0pO1xuICAgICAgc3RhdHVzLnN0ZXBzWyfmlbDmja7lr7zlhaUnXS5zdGF0dXMgPSAn5a6M5oiQJztcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgc3RhdHVzLnN0ZXBzWyfmlbDmja7lr7zlhaUnXS5zdGF0dXMgPSAn5aSx6LSlJztcbiAgICAgIHN0YXR1cy5zdGVwc1sn5pWw5o2u5a+85YWlJ10uZXJyb3IgPSBlcnJvci5tZXNzYWdlO1xuICAgICAgXG4gICAgICAvLyDlhbPplK7mraXpqqTlpLHotKXvvIzlsJ3or5Xlm57mu5pcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGV4ZWN1dGVTdGVwKCfmlbDmja7lm57mu5onLCBbXG4gICAgICAgICAgeyBjbWQ6ICdweXRob24nLCBhcmdzOiBbJ3B5L3JvbGxiYWNrX2RiLnB5J10gfVxuICAgICAgICBdKTtcbiAgICAgICAgc3RhdHVzLnN0ZXBzWyfmlbDmja7lr7zlhaUnXS5yb2xsYmFjayA9ICfmiJDlip8nO1xuICAgICAgfSBjYXRjaCAocm9sbGJhY2tFcnJvcikge1xuICAgICAgICBzdGF0dXMuc3RlcHNbJ+aVsOaNruWvvOWFpSddLnJvbGxiYWNrID0gYOWksei0pTogJHtyb2xsYmFja0Vycm9yLm1lc3NhZ2V9YDtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8g5YWz6ZSu5q2l6aqk5aSx6LSl77yM5Lit5q2i5ZCO57ut5q2l6aqkXG4gICAgICBzdGF0dXMuc3RlcHNbJ+aVsOaNruWvvOWFpSddLmVuZF90aW1lID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgICAgc3RhdHVzLmVuZF90aW1lID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgICAgc3RhdHVzLnN0YXR1cyA9ICdmYWlsZWQnO1xuICAgICAgc3RhdHVzLm1lc3NhZ2UgPSBg5pWw5o2u5a+85YWl5aSx6LSlOiAke2Vycm9yLm1lc3NhZ2V9YDtcbiAgICAgIHNhdmVTdGF0dXMoc3RhdHVzKTtcbiAgICAgIHRocm93IGVycm9yOyAvLyDkuK3mlq3mtYHnqItcbiAgICB9XG4gICAgc3RhdHVzLnN0ZXBzWyfmlbDmja7lr7zlhaUnXS5lbmRfdGltZSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICBzYXZlU3RhdHVzKHN0YXR1cyk7XG5cbiAgICAvLyDmraXpqqQ0OiDor43kupHnlJ/miJBcbiAgICBzdGF0dXMuc3RlcHNbJ+ivjeS6keeUn+aIkCddLnN0YXR1cyA9ICfmiafooYzkuK0nO1xuICAgIHN0YXR1cy5zdGVwc1sn6K+N5LqR55Sf5oiQJ10uc3RhcnRfdGltZSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICBzYXZlU3RhdHVzKHN0YXR1cyk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGV4ZWN1dGVTdGVwKCfor43kupHnlJ/miJAnLCBbXG4gICAgICAgIHsgY21kOiAncHl0aG9uJywgYXJnczogWydweS9nZW5lcmF0ZV93b3JkY2xvdWQucHknXSB9XG4gICAgICBdKTtcbiAgICAgIHN0YXR1cy5zdGVwc1sn6K+N5LqR55Sf5oiQJ10uc3RhdHVzID0gJ+WujOaIkCc7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHN0YXR1cy5zdGVwc1sn6K+N5LqR55Sf5oiQJ10uc3RhdHVzID0gJ+Wksei0pSc7XG4gICAgICBzdGF0dXMuc3RlcHNbJ+ivjeS6keeUn+aIkCddLmVycm9yID0gZXJyb3IubWVzc2FnZTtcbiAgICAgIC8vIOmdnuWFs+mUruatpemqpOWksei0pe+8jOe7p+e7reaJp+ihjFxuICAgIH1cbiAgICBzdGF0dXMuc3RlcHNbJ+ivjeS6keeUn+aIkCddLmVuZF90aW1lID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgIHNhdmVTdGF0dXMoc3RhdHVzKTtcblxuICAgIC8vIOatpemqpDU6IOaVsOaNruWkh+S7vVxuICAgIHN0YXR1cy5zdGVwc1sn5pWw5o2u5aSH5Lu9J10uc3RhdHVzID0gJ+aJp+ihjOS4rSc7XG4gICAgc3RhdHVzLnN0ZXBzWyfmlbDmja7lpIfku70nXS5zdGFydF90aW1lID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgIHNhdmVTdGF0dXMoc3RhdHVzKTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgYXdhaXQgZXhlY3V0ZVN0ZXAoJ+aVsOaNruWkh+S7vScsIFtcbiAgICAgICAgeyBjbWQ6ICdweXRob24nLCBhcmdzOiBbJ3B5L2JhY2t1cF9kYi5weSddIH1cbiAgICAgIF0pO1xuICAgICAgc3RhdHVzLnN0ZXBzWyfmlbDmja7lpIfku70nXS5zdGF0dXMgPSAn5a6M5oiQJztcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgc3RhdHVzLnN0ZXBzWyfmlbDmja7lpIfku70nXS5zdGF0dXMgPSAn5aSx6LSlJztcbiAgICAgIHN0YXR1cy5zdGVwc1sn5pWw5o2u5aSH5Lu9J10uZXJyb3IgPSBlcnJvci5tZXNzYWdlO1xuICAgICAgLy8g6Z2e5YWz6ZSu5q2l6aqk5aSx6LSl77yM5LiN5b2x5ZON5pW05L2T54q25oCBXG4gICAgfVxuICAgIHN0YXR1cy5zdGVwc1sn5pWw5o2u5aSH5Lu9J10uZW5kX3RpbWUgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgc2F2ZVN0YXR1cyhzdGF0dXMpO1xuXG4gICAgLy8g5pu05paw5pyA57uI54q25oCBXG4gICAgY29uc3QgZmFpbGVkU3RlcHMgPSBPYmplY3Qua2V5cyhzdGF0dXMuc3RlcHMpLmZpbHRlcihzdGVwID0+IFxuICAgICAgc3RhdHVzLnN0ZXBzW3N0ZXBdLnN0YXR1cyA9PT0gJ+Wksei0pSdcbiAgICApO1xuICAgIFxuICAgIHN0YXR1cy5lbmRfdGltZSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICBpZiAoZmFpbGVkU3RlcHMubGVuZ3RoID09PSAwKSB7XG4gICAgICBzdGF0dXMuc3RhdHVzID0gJ3N1Y2Nlc3MnO1xuICAgICAgc3RhdHVzLm1lc3NhZ2UgPSAn5pu05paw5oiQ5Yqf5a6M5oiQJztcbiAgICB9IGVsc2Uge1xuICAgICAgc3RhdHVzLnN0YXR1cyA9ICdwYXJ0aWFsX3N1Y2Nlc3MnO1xuICAgICAgc3RhdHVzLm1lc3NhZ2UgPSBg5pu05paw6YOo5YiG5oiQ5Yqf77yMJHtmYWlsZWRTdGVwcy5sZW5ndGh95Liq5q2l6aqk5aSx6LSlOiAke2ZhaWxlZFN0ZXBzLmpvaW4oJywgJyl9YDtcbiAgICB9XG4gICAgXG4gICAgc2F2ZVN0YXR1cyhzdGF0dXMpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIC8vIOabtOaWsOWksei0peWkhOeQhlxuICAgIHN0YXR1cy5zdGF0dXMgPSAnZmFpbGVkJztcbiAgICBzdGF0dXMuZW5kX3RpbWUgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgc3RhdHVzLm1lc3NhZ2UgPSBg5pu05paw5aSx6LSlOiAke2Vycm9yLm1lc3NhZ2V9YDtcbiAgICBzYXZlU3RhdHVzKHN0YXR1cyk7XG4gIH0gZmluYWxseSB7XG4gICAgcmVsZWFzZUxvY2soKTtcbiAgfVxufVxuXG4vKipcbiAqIEFQSeWkhOeQhuWHveaVsFxuICovXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcSwgcmVzKSB7XG4gIHRyeSB7XG4gICAgaWYgKCFmcy5leGlzdHNTeW5jKHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAndG1wJykpKSB7XG4gICAgICBmcy5ta2RpclN5bmMocGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICd0bXAnKSwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gICAgfVxuICAgIFxuICAgIGlmICghZnMuZXhpc3RzU3luYyhwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ2xvZ3MnKSkpIHtcbiAgICAgIGZzLm1rZGlyU3luYyhwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ2xvZ3MnKSwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IFxuICAgICAgc3VjY2VzczogZmFsc2UsIFxuICAgICAgbWVzc2FnZTogJ+aXoOazleWIm+W7uuaJgOmcgOebruW9lScsXG4gICAgICBlcnJvcjogZXJyb3IubWVzc2FnZVxuICAgIH0pO1xuICB9XG5cbiAgc3dpdGNoIChyZXEubWV0aG9kKSB7XG4gICAgY2FzZSAnR0VUJzpcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGlzX3J1bm5pbmc6IGlzVXBkYXRlUnVubmluZygpLFxuICAgICAgICBzdGF0dXM6IGdldFN0YXR1cygpXG4gICAgICB9KTtcbiAgICAgIFxuICAgIGNhc2UgJ1BPU1QnOlxuICAgICAgY29uc3QgcHJvdmlkZWRLZXkgPSByZXEuaGVhZGVyc1sneC1hZG1pbi1rZXknXSB8fCByZXEuYm9keT8uYWRtaW5LZXk7XG4gICAgICBpZiAocHJvdmlkZWRLZXkgIT09IEFETUlOX0tFWSkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6ICfnrqHnkIblkZjlr4bpkqXml6DmlYgnXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAocmVxLnF1ZXJ5LmFjdGlvbiA9PT0gJ3N0b3AnKSB7XG4gICAgICAgIGNvbnN0IHN0b3BwZWQgPSBzdG9wVXBkYXRlKCk7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7XG4gICAgICAgICAgc3VjY2Vzczogc3RvcHBlZCxcbiAgICAgICAgICBtZXNzYWdlOiBzdG9wcGVkID8gJ+abtOaWsOW3suWBnOatoicgOiAn5YGc5q2i5pu05paw5aSx6LSlJ1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIGF3YWl0IHJ1bkRhdGFiYXNlVXBkYXRlKHJlcyk7XG4gICAgICBcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA1KS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICfmlrnms5XkuI3lhYHorrgnXG4gICAgICB9KTtcbiAgfVxufSAiXSwibmFtZXMiOlsic3Bhd24iLCJwYXRoIiwiZnMiLCJBRE1JTl9LRVkiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfQURNSU5fS0VZIiwiTE9DS19GSUxFIiwiam9pbiIsImN3ZCIsIlNUQVRVU19GSUxFIiwiY3VycmVudFByb2Nlc3MiLCJpc1VwZGF0ZVJ1bm5pbmciLCJleGlzdHNTeW5jIiwiZXJyb3IiLCJjb25zb2xlIiwiY3JlYXRlTG9jayIsIndyaXRlRmlsZVN5bmMiLCJEYXRlIiwidG9JU09TdHJpbmciLCJyZWxlYXNlTG9jayIsInVubGlua1N5bmMiLCJzYXZlU3RhdHVzIiwic3RhdHVzIiwiSlNPTiIsInN0cmluZ2lmeSIsImdldFN0YXR1cyIsInBhcnNlIiwicmVhZEZpbGVTeW5jIiwibGFzdF9ydW4iLCJtZXNzYWdlIiwiZXhlY3V0ZUNvbW1hbmQiLCJjbWQiLCJhcmdzIiwiZXh0cmFBcmdzIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJzY3JpcHRQYXRoIiwiYWxsQXJncyIsImxlbmd0aCIsInB1c2giLCJjb25jYXQiLCJsb2ciLCJwcm9jZXNzMSIsIlBZVEhPTklPRU5DT0RJTkciLCJQWVRIT05VTkJVRkZFUkVEIiwiUFlUSE9OVVRGOCIsIm91dHB1dCIsImVycm9yT3V0cHV0Iiwic3Rkb3V0Iiwib24iLCJkYXRhIiwidGV4dCIsInRvU3RyaW5nIiwic3RkZXJyIiwiY29kZSIsIkVycm9yIiwiZXJyIiwiZXhlY3V0ZVN0ZXAiLCJzdGVwTmFtZSIsImNvbW1hbmRzIiwiY29tbWFuZCIsInN0b3BVcGRhdGUiLCJraWxsIiwicGlkIiwiZSIsImUyIiwiZW5kX3RpbWUiLCJPYmplY3QiLCJrZXlzIiwic3RlcHMiLCJmb3JFYWNoIiwic3RlcCIsInJ1bkRhdGFiYXNlVXBkYXRlIiwicmVzIiwianNvbiIsInN1Y2Nlc3MiLCJzdGFydFRpbWUiLCJzdGFydF90aW1lIiwicm9sbGJhY2siLCJyb2xsYmFja0Vycm9yIiwiZmFpbGVkU3RlcHMiLCJmaWx0ZXIiLCJoYW5kbGVyIiwicmVxIiwibWtkaXJTeW5jIiwicmVjdXJzaXZlIiwibWV0aG9kIiwiaXNfcnVubmluZyIsInByb3ZpZGVkS2V5IiwiaGVhZGVycyIsImJvZHkiLCJhZG1pbktleSIsInF1ZXJ5IiwiYWN0aW9uIiwic3RvcHBlZCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/db-update-manual.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fdb-update-manual&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cdb-update-manual.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();