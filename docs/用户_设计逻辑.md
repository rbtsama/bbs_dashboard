# 平台设计逻辑

本文档详细说明论坛数据洞察平台各功能模块的设计逻辑与数据定义，帮助您深入理解平台的工作原理与数据呈现方式。

## 数据大盘

数据大盘通过三组关键图表，全面展示论坛活动数据，帮助您掌握社区动态。

### 发帖量图表

**数据定义**：
- **数据来源**：`post_statistic` 表
- **统计对象**：新发布的帖子数量
- **时间维度**：支持小时、日、周、月四种粒度
- **计算逻辑**：
  - 小时统计：基于 `post_time_R`（发帖时间取整到15分钟）分组统计
  - 日统计：按照帖子发布日期（年-月-日）分组
  - 周统计：按照帖子发布的自然周分组
  - 月统计：按照帖子发布的自然月分组

**特点说明**：
- 发帖量反映了社区内容创作的活跃度
- 时间维度的灵活切换，可以识别出周期性的活跃模式
- 峰值通常对应特定事件或社区活动

### 阅读量图表

**数据定义**：
- **数据来源**：`view_statistic` 表
- **统计对象**：论坛帖子的阅读量增长
- **时间维度**：支持小时、日、周、月四种粒度
- **计算逻辑**：
  - 阅读量差值：当前时间点的累计阅读量 - 上一时间点的累计阅读量
  - 负值处理：如果差值为负（可能因数据采集原因），则设为0

**特点说明**：
- 阅读量差值更能反映真实的用户阅读行为
- 累计阅读量持续增长，而差值反映特定时段的热度
- 阅读高峰通常滞后于发帖高峰，反映用户浏览行为模式
- 周末和工作日有明显的阅读量差异模式

### 更新分类图表

**数据定义**：
- **数据来源**：`update_statistic` 表
- **统计对象**：帖子的三种更新类型
- **更新分类**：
  1. **重发（Repost）**：帖子被原作者重新发布，提升可见度
  2. **回帖（Reply）**：帖子收到新回复，增加互动
  3. **删回帖（Delete Reply）**：帖子的回复被删除
- **计算逻辑**：
  - 基于 `update_reason` 字段分类统计
  - 通过 `list_time_R`（更新时间取整到15分钟）聚合

**特点说明**：
- 重发数量反映作者对帖子曝光度的追求
- 回帖数量反映社区的互动热度
- 删回帖频率反映社区管理活动或用户行为调整
- 三种行为占比的变化可反映社区氛围的整体变化

## 活跃榜单

活跃榜单从不同维度展示论坛中最活跃的元素，包括帖子、用户及其历史活动。

### 帖子排行榜

**数据定义**：
- **数据来源**：`post_ranking` 表
- **关键字段**：
  - `url`：帖子唯一链接
  - `title`：帖子标题
  - `author`：发帖人
  - `days_old`：帖子已发布天数，计算逻辑为（当前日期 - 首次发现日期）
  - `last_active`：最后活跃时间戳，取帖子在更新列表中最后一次出现的时间，以时间戳形式存储（秒数）
  - `read_count`：累计阅读次数
  - `reply_count`：累计回复次数
  - `repost_count`：重发次数
  - `delete_reply_count`：删回帖次数

**排序逻辑**：
- 默认按 `last_active` 倒序排列，展示最近活跃的帖子
- 支持按 `read_count`、`reply_count` 等字段自定义排序
- 可设置 `days_old` 过滤器，专注查看特定时间范围内的帖子

### 用户排行榜

**数据定义**：
- **数据来源**：`author_ranking` 表
- **关键字段**：
  - `author`：作者名称
  - `author_link`：作者主页链接
  - `days_old`：作者首次发帖距今天数
  - `last_active`：最后活跃时间戳，取作者的任何帖子在更新列表中最后一次出现的时间
  - `active_posts`：当前活跃的帖子数量
  - `repost_count`：作者所有帖子的总重发次数
  - `reply_count`：作者所有帖子收到的总回复数
  - `delete_reply_count`：作者所有帖子的总删回帖次数

**排序逻辑**：
- 默认按 `last_active` 倒序排列，展示最近活跃的作者
- 支持按 `active_posts`、`reply_count` 等字段自定义排序
- 可设置活跃度过滤器，专注查看符合特定活跃度标准的作者

### 更新历史

**数据定义**：
- **数据来源**：`post_history` 表
- **呈现内容**：
  - 特定帖子的完整更新记录
  - 包含每次更新的类型、时间和状态变化
  - 支持按时间顺序或倒序查看
- **字段映射**：
  - 前端使用 `event_type` 和 `event_time` 字段（分别映射自后端的 `action` 和 `action_time`）
  - 统一字段命名提升用户体验，同时保持后端数据结构兼容性

**特点说明**：
- 支持通过 `HoverActionLogs` 组件快速预览历史
- 点击查看详情可打开完整的 `ActionLogs` 视图
- 完整记录帖子生命周期中的每一次状态变化

### 发帖历史

**数据定义**：
- **数据来源**：基于 `post_history` 表过滤特定作者的记录
- **呈现内容**：
  - 特定作者的所有发帖记录
  - 包含每篇帖子的标题、发布时间和后续活动
  - 区分活跃和非活跃帖子

**特点说明**：
- **标签处理逻辑**：
  - 系统尝试从帖子内容中提取标签
  - 若找不到标签，则显示"找不到标签"提示
  - 标签有助于理解作者的内容偏好和专业领域

## 追踪目标

追踪目标功能允许用户持续关注特定帖子，管理个人关注列表。

### 关注功能逻辑

**数据定义**：
- **数据来源**：`thread_follow` 表
- **关注类型**：
  - `my_follow`：用户关注的其他帖子
  - `marked`：用户自己的帖子
- **互斥性规则**：
  - 同一帖子不能同时被标记为 `my_follow` 和 `marked`
  - 切换类型时，系统自动更新而非创建新记录
- **状态管理**：
  - `follow_status` 字段控制关注状态
  - 支持临时取消关注而不删除记录，便于后续重新激活

**功能特点**：
- 一键添加/移除关注
- 关注列表自动同步最新状态
- 支持按类型筛选查看
- 关注数据持久化存储，跨会话保持

## 高频词云

高频词云通过文本分析技术，生成视觉化的关键词展示。

### 词汇取值方法

**数据处理流程**：
1. **文本获取**：
   - 整体词云：从所有帖子标题中提取文本
   - 用户词云：从特定用户的所有帖子标题中提取文本
   - 帖子词云：从特定帖子的标题和内容中提取文本
2. **文本预处理**：
   - 去除特殊字符、HTML标签和无意义符号
   - 转换为小写，便于统计
   - 移除停用词（常见但无意义的词如"的"、"了"等）
3. **分词处理**：
   - 使用jieba库进行中文分词
   - 英文按空格分词，保留有意义的短语
4. **词频统计**：
   - 计算每个词出现的次数
   - 过滤出现频率过低的词（默认阈值为2次）

### 权重设计

**权重计算逻辑**：
- **基础权重**：词频（出现次数）
- **位置加权**：标题中出现的词权重 × 1.5
- **长度调整**：
  - 单字词权重 × 0.8（降低单字词的权重）
  - 超长词（>10字符）权重 × 0.9
- **时间衰减**：较早帖子中的词权重随时间递减
  - 衰减公式：`原权重 × (1 - 0.05 × 帖子天数/30)`，最低衰减至原值的50%

**呈现效果**：
- 词大小与权重正相关
- 颜色随机分配，增强可读性
- 布局自动优化，避免过度重叠

## 全美收车

全美收车功能利用人工智能技术，从论坛帖子中提取和分析车辆信息。

### AI识别方法

**技术实现**：
- **文本提取**：从 `detail` 表中提取帖子标题和内容
- **模式识别**：
  - 使用正则表达式识别结构化信息（年份、价格、里程等）
  - 使用预定义词典匹配车辆品牌和型号
- **AI增强**：
  - 对于复杂或非结构化描述，使用自然语言处理模型辅助识别
  - 模型采用基于规则和统计的混合方法，提高识别准确率

**识别字段**：
- `year`：车辆年份，从4位数字中识别
- `make`：品牌，从预定义品牌词典中匹配
- `model`：型号，基于已识别品牌的对应型号词典匹配
- `miles`：里程，识别包含"k"、"miles"、"公里"等关键词附近的数字
- `price`：价格，识别包含"$"、"asking"、"obo"等关键词附近的数字
- `trade_type`：交易类型，如"for sale"、"want to buy"等
- `location`：地点，从内容中识别地名、州名、邮编等

**数据标准化**：
- **品牌统一**：中英文品牌名称统一转换（如"Toyota"→"丰田"）
- **型号统一**：中英文型号名称统一转换（如"塞纳"→"Sienna"）
- **年份格式化**：处理"XX年"格式，转换为标准4位数年份
- **里程标准化**：处理多种里程表示方式，统一为"XX,XXX mi"格式
- **价格格式化**：统一价格显示为美元格式

**品牌型号映射**：
- 品牌映射：如 'Honda' → '本田', 'Mazda' → '马自达'
- 型号映射：如 '塞纳' → 'Sienna', '雅阁' → 'Accord'
- 品牌与型号对应关系处理：根据型号自动纠正品牌

**数据更新**：
- 车辆信息初次提取后存入 `car_info` 表
- 进一步处理后存入 `car_detail` 表，与其他系统表关联
- 定期重新分析更新的帖子，保持数据最新 