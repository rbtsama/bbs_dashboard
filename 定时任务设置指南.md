# Windows定时任务设置指南

本指南将帮助您设置Windows定时任务来定期执行数据备份和修复脚本。

## 设置关注数据自动备份

### 步骤1：打开任务计划程序

1. 按下 `Win + R` 键
2. 输入 `taskschd.msc` 并点击确定

### 步骤2：创建新任务

1. 在右侧操作面板中点击 `创建基本任务`
2. 输入任务名称，例如 `论坛数据备份` 和描述（可选）
3. 点击 `下一步`

### 步骤3：设置任务触发器

1. 选择触发频率（建议：`每天`）
2. 点击 `下一步`
3. 设置开始时间（建议：晚间非使用高峰时段，如 `凌晨3:00`）
4. 点击 `下一步`

### 步骤4：设置任务操作

1. 选择 `启动程序`
2. 点击 `下一步`
3. 在 `程序或脚本` 框中，输入 `cmd.exe`
4. 在 `添加参数` 框中，输入 `/c ""%~dp0schedule_backup.bat""` （包含引号）
5. 在 `起始于` 框中，输入项目根目录的完整路径，例如 `F:\pj\bbs_data`
6. 点击 `下一步`

### 步骤5：完成设置

1. 检查设置摘要
2. 勾选 `当点击"完成"时，打开此任务属性对话框`
3. 点击 `完成`
4. 在打开的属性对话框中，进行高级设置：
   - 切换到 `常规` 选项卡
   - 选择 `不管用户是否登录都要运行`
   - 选择 `使用最高权限运行`
   - 适用于 `Windows 10` 选择 `配置用于：Windows 10`
5. 点击 `确定` 保存设置

## 安排数据库更新后自动修复

在完成数据库更新后，建议手动运行 `post_update_fix.bat` 脚本确保数据一致性。但如果您希望将其也加入自动计划任务，可以遵循以下步骤：

1. 按照上述步骤1-2创建名为 `数据库更新后修复` 的新任务
2. 在步骤3中，选择 `当特定事件被记录时`
3. 设置自定义事件触发器，例如：
   - 日志：`应用程序`
   - 来源：`数据库更新服务`（需根据您的系统实际日志来源设置）
   - 事件ID：完成更新的事件ID
4. 在步骤4中按照上述设置，但使用 `post_update_fix.bat` 脚本
5. 完成剩余设置步骤

## 手动运行脚本

如果您需要手动运行这些脚本：

1. 打开命令提示符或PowerShell窗口
2. 切换到项目目录：`cd F:\pj\bbs_data`（替换为您的实际路径）
3. 运行所需脚本：
   - 数据备份：`schedule_backup.bat`
   - 数据修复：`post_update_fix.bat`
   - 全面修复：`python fix_all.py`

## 注意事项

1. 确保Python环境变量已正确设置，使`python`命令能在命令行中正常工作
2. 定期检查备份文件的完整性和有效性
3. 建议至少保留最近7天的备份文件
4. 如果修改了项目路径，需同步更新任务计划程序中的路径设置 